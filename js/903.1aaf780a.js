"use strict";(globalThis["webpackChunkposweb"]=globalThis["webpackChunkposweb"]||[]).push([[903],{70903:(e,o,l)=>{l.r(o),l.d(o,{default:()=>le});var a=l(59835),t=l(86970);const n={class:"row"},i={class:"col col-xs-12 col-sm-6"},u={class:"col col-xs-12 col-sm-6"},r=(0,a._)("div",{class:"text-subtitle2"},"Número de nota de credito",-1),d={class:"text-h5"},c=(0,a._)("div",{class:"text-subtitle2"},"Subtotal",-1),s={class:"text-h4"},v={class:"row"},m={class:"row"},p={class:"col col-xs-12 col-sm-7 q-mb-md"},f={key:0,class:"bg-red text-h6 q-ma-xs"},g={class:"row"},b={class:"col col-xs-12 col-sm-8"},h={class:"col col-xs-12 col-sm-3 q-mr-sm q-mt-xs"},w=(0,a._)("br",null,null,-1),D={key:1,class:"col col-2 text-subtitle2 q-ma-xs"};function P(e,o,l,P,y,C){const k=(0,a.up)("KeyPageDetect"),V=(0,a.up)("DevDialog"),_=(0,a.up)("q-input"),H=(0,a.up)("q-card-section"),q=(0,a.up)("q-separator"),x=(0,a.up)("q-btn"),L=(0,a.up)("q-card"),W=(0,a.up)("q-checkbox"),N=(0,a.up)("q-form"),O=(0,a.up)("q-icon"),U=(0,a.up)("q-table"),Z=(0,a.up)("q-page");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(k),(0,a.Wm)(V,{ref:"NCDialogRef",onDatos:e.onOk},null,8,["onDatos"]),(0,a.Wm)(Z,{padding:""},{default:(0,a.w5)((()=>[(0,a._)("div",n,[(0,a._)("div",i,[(0,a.Uk)((0,t.zw)(e.factura)+" - "+(0,t.zw)(e.serie)+" ",1),(0,a.Wm)(_,{modelValue:e.nit,"onUpdate:modelValue":o[0]||(o[0]=o=>e.nit=o),type:"text",label:"Nit"},null,8,["modelValue"]),(0,a.Wm)(_,{modelValue:e.nombre,"onUpdate:modelValue":o[1]||(o[1]=o=>e.nombre=o),type:"text",label:"Nombre"},null,8,["modelValue"]),(0,a.Wm)(_,{modelValue:e.direccion,"onUpdate:modelValue":o[2]||(o[2]=o=>e.direccion=o),type:"text",label:"Dirección"},null,8,["modelValue"])]),(0,a._)("div",u,[(0,a.Wm)(L,null,{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[r,(0,a._)("div",d,(0,t.zw)(e.numeroDev),1)])),_:1}),(0,a.Wm)(q,{color:"blue"}),(0,a.Wm)(H,{class:""},{default:(0,a.w5)((()=>[c,(0,a._)("div",s,"Q."+(0,t.zw)(e.subTotal),1)])),_:1}),0===e.numeroDev?((0,a.wg)(),(0,a.j4)(x,{key:0,class:"q-ma-sm",label:"Crear nota de credito",color:"blue",onClick:e.crearNota},null,8,["onClick"])):(0,a.kq)("",!0),e.numeroDev>0?((0,a.wg)(),(0,a.j4)(x,{key:1,class:"q-ma-sm",label:"Generar nota de credito",color:"green",onClick:e.generarNota},null,8,["onClick"])):(0,a.kq)("",!0)])),_:1})])]),(0,a._)("div",v,[(0,a.Wm)(L,{class:"col"},{default:(0,a.w5)((()=>[(0,a.Wm)(H,null,{default:(0,a.w5)((()=>[(0,a._)("div",m,[(0,a._)("div",p,[(0,a.Wm)(N,{ref:"formDetRef"},{default:(0,a.w5)((()=>[e.enableEliminar?((0,a.wg)(),(0,a.iD)("div",f," Eliminando Producto "+(0,t.zw)(e.producto),1)):(0,a.kq)("",!0),(0,a._)("div",g,[(0,a._)("div",b,[(0,a.Wm)(_,{disable:e.loadAgregando,label:"Producto",dense:"",modelValue:e.producto,"onUpdate:modelValue":o[5]||(o[5]=o=>e.producto=o),class:"q-pr-md",color:"black",debounce:"250",onKeypress:o[6]||(o[6]=o=>e.keyPressProducto(o)),onKeydownCapture:o[7]||(o[7]=o=>e.keyDownProducto(o)),ref:"productoRef","hide-bottom-space":"",loading:e.loadProducto},{append:(0,a.w5)((()=>[(0,a.Wm)(W,{modelValue:e.enableCantidad,"onUpdate:modelValue":o[3]||(o[3]=o=>e.enableCantidad=o),"checked-icon":"shopping_cart_checkout","unchecked-icon":"remove_shopping_cart","keep-color":""},null,8,["modelValue"])])),prepend:(0,a.w5)((()=>[])),before:(0,a.w5)((()=>[(0,a.Wm)(W,{class:"q-ma-none q-pa-none",modelValue:e.enableEliminar,"onUpdate:modelValue":o[4]||(o[4]=o=>e.enableEliminar=o),size:!1===e.enableEliminar?"sm":"xl",color:!1===e.enableEliminar?"black":"red","checked-icon":"delete_forever","unchecked-icon":"delete","keep-color":""},null,8,["modelValue","size","color"])])),_:1},8,["disable","modelValue","loading"])]),(0,a._)("div",h,[(0,a.Wm)(_,{label:"Cantidad",dense:"",modelValue:e.cantidadProducto,"onUpdate:modelValue":o[8]||(o[8]=o=>e.cantidadProducto=o),disable:!e.enableCantidad,onKeydownCapture:o[9]||(o[9]=o=>e.keyDownProductoCant(o)),ref:"cantRef",rules:[e=>!!e||"Debe ingresar la cantidad",e=>0!==parseInt(e)||"La cantidad no puede ser cero"],"hide-bottom-space":""},null,8,["modelValue","disable","rules"])]),""!==e.descripcionProd?((0,a.wg)(),(0,a.iD)("div",{key:0,class:(0,t.C_)(["col col-8 text-subtitle2 q-ma-xs","Producto no encotrado"===e.descripcionProd?"bg-red":""])},[(0,a.Uk)((0,t.zw)(e.maestroProducto)+" - "+(0,t.zw)(e.descripcionProd)+" ",1),w,(0,a.Uk)(" Lote: "+(0,t.zw)(e.lote)+" - "+(0,t.zw)(e.descripcionLote),1)],2)):(0,a.kq)("",!0),""!==e.descripcionProd?((0,a.wg)(),(0,a.iD)("div",D," Precio: "+(0,t.zw)(e.precioProducto),1)):(0,a.kq)("",!0)])])),_:1},512)])])])),_:1}),(0,a.Wm)(q,{color:"blue"}),(0,a.Wm)(H,{class:"detalles"},{default:(0,a.w5)((()=>[(0,a.Wm)(U,{dense:"",columns:e.columnsAgregados,rows:e.rowsAgregados,"row-key":"producto",filter:e.filterAgregados,pagination:{rowsPerPage:20},style:{height:"500px"}},{"top-right":(0,a.w5)((()=>[(0,a.Wm)(_,{borderless:"",dense:"",modelValue:e.filterAgregados,"onUpdate:modelValue":o[10]||(o[10]=o=>e.filterAgregados=o),placeholder:"Buscar"},{append:(0,a.w5)((()=>[(0,a.Wm)(O,{name:"search"})])),_:1},8,["modelValue"])])),_:1},8,["columns","rows","filter"])])),_:1})])),_:1})])])),_:1})],64)}var y=l(61957);function C(e,o,l,t,n,i){const u=(0,a.up)("q-input"),r=(0,a.up)("q-card-section"),d=(0,a.up)("q-btn"),c=(0,a.up)("q-card-actions"),s=(0,a.up)("q-card"),v=(0,a.up)("q-dialog");return(0,a.wg)(),(0,a.j4)(v,{ref:"dialogRef",onHide:e.onDialogHide,persistent:""},{default:(0,a.w5)((()=>[(0,a.Wm)(s,{class:"q-dialog-plugin"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.Wm)(u,{modelValue:e.factura,"onUpdate:modelValue":o[0]||(o[0]=o=>e.factura=o),type:"text",label:"Número de factura",rules:[e=>!!e||"Debe ingresar el número de factura"]},null,8,["modelValue","rules"]),(0,a.Wm)(u,{modelValue:e.serie,"onUpdate:modelValue":o[1]||(o[1]=o=>e.serie=o),type:"text",label:"Serie de la factura",rules:[e=>!!e||"Debe ingresar la serie"]},null,8,["modelValue","rules"]),(0,a.Wm)(u,{modelValue:e.pass,"onUpdate:modelValue":o[2]||(o[2]=o=>e.pass=o),type:"password",label:"Clave de autorización",rules:[e=>!!e||"Debe ingresar la clave"],onKeydown:(0,y.D2)(e.onOKClick,["enter"])},null,8,["modelValue","rules","onKeydown"])])),_:1}),(0,a.Wm)(c,{align:"right"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{color:"primary",label:"OK",onClick:e.onOKClick},null,8,["onClick"]),(0,a.Wm)(d,{color:"primary",label:"Cancel",onClick:e.onCancelClick},null,8,["onClick"])])),_:1})])),_:1})])),_:1},8,["onHide"])}var k=l(60499),V=l(50906),_=l(34136),H=l(67825),q=l(68651),x=l(18910),L=l(17779),W=function(e,o,l,a){function t(e){return e instanceof l?e:new l((function(o){o(e)}))}return new(l||(l=Promise))((function(l,n){function i(e){try{r(a.next(e))}catch(o){n(o)}}function u(e){try{r(a["throw"](e))}catch(o){n(o)}}function r(e){e.done?l(e.value):t(e.value).then(i,u)}r((a=a.apply(e,o||[])).next())}))};const N=(0,a.aZ)({name:"DevDialog",props:{ref:{type:String}},emits:[...V.Z.emits,"datos"],setup(e,{emit:o}){const l=(0,x.tv)(),{dialogRef:a,onDialogHide:t,onDialogOK:n,onDialogCancel:i}=(0,V.Z)(),u=(0,k.iH)(),r=(0,k.iH)((0,H.dS)()),d=(0,k.iH)(""),c=()=>{var e;null===(e=a.value)||void 0===e||e.show()};let s=null;const v=()=>W(this,void 0,void 0,(function*(){let e={NumeroFactura:u.value,Pass:d.value},o=!1;return yield _.api.post(_.endPoints.DEVOLUCIONENC+"VALIDAR",e,(0,_.configApi)({serie:r.value})).then((e=>{s=e.data.Factura,L.log(s),o=!0})).catch((e=>{(0,q.L1)(e),o=!1})),o})),m=()=>W(this,void 0,void 0,(function*(){let e=yield v();e&&(o("datos",{factura:u.value,serie:r.value,datosFactura:s}),n())})),p=()=>{i(),l.back()};return{dialogRef:a,factura:u,serie:r,pass:d,show:c,onDialogHide:t,onOKClick:m,onCancelClick:p}},mounted(){this.show()}});var O=l(11639),U=l(32074),Z=l(44458),E=l(63190),Q=l(13119),R=l(11821),A=l(68879),K=l(69984),I=l.n(K);const z=(0,O.Z)(N,[["render",C]]),F=z;I()(N,"components",{QDialog:U.Z,QCard:Z.Z,QCardSection:E.Z,QInput:Q.Z,QCardActions:R.Z,QBtn:A.Z});var T=l(30336),S=l(17779),j=function(e,o,l,a){function t(e){return e instanceof l?e:new l((function(o){o(e)}))}return new(l||(l=Promise))((function(l,n){function i(e){try{r(a.next(e))}catch(o){n(o)}}function u(e){try{r(a["throw"](e))}catch(o){n(o)}}function r(e){e.done?l(e.value):t(e.value).then(i,u)}r((a=a.apply(e,o||[])).next())}))};const B=[{name:"Producto",label:"Producto",field:"Producto",align:"center"},{name:"Descripcion",label:"Descripción",field:"Descripcion",align:"center"},{name:"Lote",label:"Lote",field:"Lote",align:"center"},{name:"DescripcionLote",label:"Descripción Lote",field:"DescripcionLote",align:"center"},{name:"Cantidad",label:"Cantidad",field:"Cantidad",align:"center"},{name:"Precio",label:"Precio",field:"Precio",align:"center"},{name:"Subtotal",label:"Subtotal",field:"Subtotal",align:"center",format:(e,o)=>`Q.${e}`}],G=(0,a.aZ)({name:"Devoluciones",components:{DevDialog:F,KeyPageDetect:T.Z},setup(e,{emit:o}){const l=(0,k.iH)(0),a=(0,k.iH)(""),t=(0,k.iH)(""),n=(0,k.iH)(""),i=(0,k.iH)(""),u=(0,k.iH)(0),r=(0,k.iH)(0),d=(0,k.iH)([]),c=(0,k.iH)(""),s=(0,k.iH)(""),v=(0,k.iH)(""),m=(0,k.iH)(""),p=(0,k.iH)(!1),f=(0,k.iH)(""),g=(0,k.iH)(""),b=(0,k.iH)(0),h=(0,k.iH)(!1),w=(0,k.iH)(!1),D=(0,k.iH)(!1),P=(0,k.iH)(1),y=(0,k.iH)(""),C=(0,k.iH)(null),V=(0,k.iH)(null),H=(0,k.iH)(null),x=(0,k.iH)(null),L=e=>{l.value=e.factura,a.value=e.serie,n.value=e.datosFactura.Nombre,t.value=e.datosFactura.Nit,i.value=e.datosFactura.Direccion},W=e=>j(this,void 0,void 0,(function*(){var o,l,a,t;if(!h.value&&(S.log("Key press"),"Enter"===e.key)){if(yield new Promise((e=>setTimeout(e,500))),p.value)while(p.value)S.log("esperando..."),yield new Promise((e=>setTimeout(e,500)));let e=yield null===(o=C.value)||void 0===o?void 0:o.validate();e&&(w.value?null===(l=V.value)||void 0===l||l.focus():D.value?(yield E(),null===(a=H.value)||void 0===a||a.focus()):(yield Z(),null===(t=H.value)||void 0===t||t.focus()))}})),N=e=>{"+"===e.key?(e.ctrlKey?w.value=!0:P.value++,e.preventDefault()):"-"===e.key&&(e.ctrlKey?w.value=!1:P.value>1&&P.value--,e.preventDefault())},O=e=>j(this,void 0,void 0,(function*(){var o,l,a;if("Enter"===e.key){let e=yield null===(o=C.value)||void 0===o?void 0:o.validate();e&&(D.value?(yield E(),null===(l=H.value)||void 0===l||l.focus()):(yield Z(),null===(a=H.value)||void 0===a||a.focus()),P.value=1)}})),U=()=>{_.api.get(_.endPoints.DEVOLUCIONDET+u.value).then((e=>{d.value=e.data.Detalles,r.value=0,d.value.map((e=>{r.value+=e.Subtotal}))})).catch((e=>{(0,q.L1)(e)}))},Z=()=>j(this,void 0,void 0,(function*(){var e,o;if(0===u.value)return void(0,q.x2)("Debe crear una devolución primero");if(""!==s.value&&""===f.value)return void(0,q.x2)("Debe ingresar el lote");h.value=!0;let a=yield null===(e=C.value)||void 0===e?void 0:e.validate(),t={NumeroFactura:l.value,Devolucion:u.value,Producto:s.value,Lote:f.value,Cantidad:P.value};a&&(yield _.api.post(_.endPoints.DEVOLUCIONDET,t).then((e=>{(0,q.dF)("Producto "+s.value+" agregado correctamente"),v.value=""})).catch((e=>{var o,l;h.value=!1,null===(o=H.value)||void 0===o||o.select(),null===(l=H.value)||void 0===l||l.focus(),(0,q.L1)(e,{position:"top"})})),U()),h.value=!1,null===(o=H.value)||void 0===o||o.focus()})),E=()=>j(this,void 0,void 0,(function*(){var e,o;if(0===u.value)return void(0,q.x2)("Debe crear una devolución primero");h.value=!0;let a=yield null===(e=C.value)||void 0===e?void 0:e.validate();if(a){let e={NumeroFactura:l.value,Devolucion:u.value,Producto:s.value,Lote:f.value,Cantidad:P.value};yield _.api.delete(_.endPoints.DEVOLUCIONDET,(0,_.configApi)({datos:e})).then((e=>{U(),(0,q.dF)("Producto eliminado correctamente"),v.value=""})).catch((e=>{(0,q.L1)(e,{timeout:0,position:"right"})}))}h.value=!1,null===(o=H.value)||void 0===o||o.focus()})),Q=()=>j(this,void 0,void 0,(function*(){var e,o;if(!v.value&&""===v.value)return m.value="",b.value=0,f.value="",s.value="",void(null===(e=H.value)||void 0===e||e.focus());p.value=!0,yield _.api.get(_.endPoints.PRODUCTO+"1/"+v.value).then((e=>{var o;if(S.log(e.data),null==e.data.Producto)return m.value="Producto no encotrado",b.value=0,f.value="",g.value="",s.value="",p.value=!1,void(null===(o=H.value)||void 0===o||o.focus());s.value=e.data.Producto.Producto,m.value=e.data.Producto.Descripcion,""!==e.data.Producto.Lote&&(f.value=e.data.Producto.Lote),p.value=!1})).catch((e=>{p.value=!1,S.log(e),(0,q.L1)(e)})),null===(o=H.value)||void 0===o||o.focus()})),R=()=>j(this,void 0,void 0,(function*(){(v.value||""!==v.value)&&(yield _.api.get(_.endPoints.PRODUCTO+"1/"+v.value).then((e=>{if(null==e.data.Producto)return f.value="",void(g.value="");g.value=e.data.Producto.DescripcionLote})).catch((e=>{S.log(e),(0,q.L1)(e)})))})),A=()=>{_.api.post(_.endPoints.DEVOLUCIONENC,l.value).then((e=>{S.log(e.data),u.value=e.data.Devolucion})).catch((e=>{S.log(e),(0,q.L1)(e)}))},K=()=>{(0,q.wp)("Confirmación","¿Desea genera la nota de credito?",{onPressOk:()=>{I()}})},I=()=>j(this,void 0,void 0,(function*(){const e={NumeroFactura:l.value,NumeroDevolucion:u.value};yield _.api.post(_.endPoints.DEVOLUCIONENC+"AUTORIZAR",e).then((e=>{y.value=e.data.Uuid,(0,q.dF)("Devolucion generada correctamente "+y.value),z()})).catch((e=>{S.log(e),(0,q.L1)(e,{timeout:0,position:"top"})}))})),z=()=>{let e=800,o=500;var l=screen.width/2-e/2,t=screen.height/2-o/2;let n="#/Reportes/NCDEV/"+a.value+"/"+u.value;S.log(n);try{var i=window.open(n,"NC","addressbar=no,directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=no,width="+e+", height="+o+", top="+t+", left="+l);const a=setInterval((()=>{(null===i||void 0===i?void 0:i.closed)&&(clearInterval(a),location.reload())}),500)}catch(r){S.log(r)}};return{onOk:L,keyDownProducto:N,keyDownProductoCant:O,keyPressProducto:W,consultarProducto:Q,consultarLote:R,crearNota:A,generarNota:K,factura:l,serie:a,nit:t,nombre:n,direccion:i,columnsAgregados:B,rowsAgregados:d,filterAgregados:c,maestroProducto:s,producto:v,descripcionProd:m,loadProducto:p,lote:f,descripcionLote:g,precioProducto:b,loadAgregando:h,enableCantidad:w,enableEliminar:D,cantidadProducto:P,numeroDev:u,subTotal:r,formDetRef:C,cantRef:V,productoRef:H,NCDialogRef:x}},mounted(){var e;null===(e=this.NCDialogRef)||void 0===e||e.show()},watch:{producto(e){let o="";o=e,o=o.trim().replace("+","").replace("*","").replace("/",""),this.producto=o,this.consultarProducto()},lote(e){this.consultarLote()}}});var Y=l(69885),$=l(50926),J=l(8326),M=l(11221),X=l(84277),ee=l(22857);const oe=(0,O.Z)(G,[["render",P]]),le=oe;I()(G,"components",{QPage:Y.Z,QInput:Q.Z,QCard:Z.Z,QCardSection:E.Z,QSeparator:$.Z,QBtn:A.Z,QForm:J.Z,QCheckbox:M.Z,QTable:X.Z,QIcon:ee.Z})}}]);