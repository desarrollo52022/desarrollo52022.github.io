"use strict";(globalThis["webpackChunkposweb"]=globalThis["webpackChunkposweb"]||[]).push([[8605],{98605:(e,a,o)=>{o.r(a),o.d(a,{default:()=>ye});var l=o(59835),i=o(86970);const t={class:"row"},n={class:"col-xs-12 col-sm-3"},r={class:"col-xs-12 col-sm-5 q-pl-md"},d={class:"col-12 row"},c=(0,l._)("div",{class:"col-6"},[(0,l._)("div",{class:"text-h6 text-center"}," MAYORISTAS ")],-1),u={class:"col-6 bg-grey"},s={class:"text-h6 text-center"},m=(0,l._)("div",{class:"col-6"},[(0,l._)("div",{class:"text-h6 text-center"}," Número de pedido ")],-1),v={class:"col-6"},p={class:"text-h6 text-center"},g={class:"col-xs-12 col-sm-2 q-pl-md"},f={class:"col q-pa-md"};function b(e,a,o,b,w,h){const C=(0,l.up)("q-btn"),y=(0,l.up)("q-checkbox"),P=(0,l.up)("facturacion-may-dialog"),_=(0,l.up)("q-badge"),x=(0,l.up)("q-inner-loading"),T=(0,l.up)("q-td"),q=(0,l.up)("q-tr"),k=(0,l.up)("q-grid"),F=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(F,{padding:""},{default:(0,l.w5)((()=>{var o;return[(0,l._)("div",t,[(0,l._)("div",n,[(0,l.Wm)(C,{class:"q-ma-xs full-width",color:"primary",label:"PEDIDO",onClick:e.reimprmirPedido},null,8,["onClick"]),(0,l.Wm)(C,{class:"q-ma-xs full-width",color:"primary",icon:"print",label:"REIMPRIMIR FEL",onClick:e.reimprimirFel},null,8,["onClick"]),(0,l.Wm)(C,{class:"q-ma-xs full-width",color:"primary",icon:"adf_scanner",label:"REIMPRIMIR CONTINGENCIA",onClick:e.reimprimirContingencia},null,8,["onClick"])]),(0,l._)("div",r,[(0,l.Wm)(y,{modelValue:e.contingencia,"onUpdate:modelValue":a[0]||(a[0]=a=>e.contingencia=a),label:"FAC. CONTINGENCIA"},null,8,["modelValue"]),(0,l._)("div",d,[c,(0,l._)("div",u,[(0,l._)("div",s,(0,i.zw)(e.condicion),1)]),m,(0,l._)("div",v,[(0,l._)("div",p,(0,i.zw)(e.numeroPedido),1)])])]),(0,l._)("div",g,[(0,l.Wm)(P,{disable:e.numeroPedido<=0,numeroPedido:e.numeroPedido,serie:null!==(o=e.serie)&&void 0!==o?o:"",contingencia:e.contingencia,Total:e.total,Credito:e.tipo,tipoPedido:2,onFacturado:e.facturar,onCuponAplicado:e.updateTotal},null,8,["disable","numeroPedido","serie","contingencia","Total","Credito","onFacturado","onCuponAplicado"]),(0,l.Wm)(C,{class:"q-ma-sm full-width",color:"primary",icon:"keyboard_return",label:"REGRESAR",onClick:e.regresar},null,8,["onClick"])]),(0,l._)("div",f,[(0,l.Wm)(C,{color:"primary",icon:"refresh",label:"Cargar datos",onClick:e.getPedidos},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{color:e.wsStatus?"green":"red",floating:""},null,8,["color"])])),_:1},8,["onClick"])])]),(0,l._)("div",null,[(0,l.Wm)(k,{class:"afacturar",data:e.rows,columns:e.columnas,columns_filter:!0,pagination:{rowsPerPage:0},loading:e.loading},{loading:(0,l.w5)((()=>[(0,l.Wm)(x,{showing:"",color:"primary"})])),body:(0,l.w5)((a=>[(0,l.Wm)(q,{props:a,onClick:o=>e.selectProd(o,a.row),class:(0,i.C_)([a.row.Pedido===e.numeroPedido?"bg-grey":"","cursor-pointer"])},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.columnas,(e=>((0,l.wg)(),(0,l.j4)(T,{key:e.name,class:"text-center"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(a.row[e.field.toString()]),1)])),_:2},1024)))),128))])),_:2},1032,["props","onClick","class"])])),_:1},8,["data","columns","loading"])])]})),_:1})}var w=o(34136),h=o(32222),C=o(67825),y=o(68651),P=o(84619),_=o(60499),x=o(61957);const T=(0,l.Uk)(" Minimize "),q=(0,l.Uk)(" Maximize "),k=(0,l.Uk)("Cerrar"),F={class:"text-h6 text-center"},I={class:"text-h6 text-center"},A={class:"text-h4 bg-red text-center"},R={class:"row justify-center"},E={class:"col-6"},Z={class:"col-3"},W={class:"row text-center"},S={class:"col col-12"},z={class:"text-h5 q-pl-md"},N={class:"col col-6"},Q={class:"col col-12"},U=(0,l.Uk)(" Facturando... ");function H(e,a,o,t,n,r){const d=(0,l.up)("q-btn"),c=(0,l.up)("q-space"),u=(0,l.up)("q-tooltip"),s=(0,l.up)("q-bar"),m=(0,l.up)("q-icon"),v=(0,l.up)("q-input"),p=(0,l.up)("q-checkbox"),g=(0,l.up)("q-spinner-hourglass"),f=(0,l.up)("q-form"),b=(0,l.up)("q-card-section"),w=(0,l.up)("q-card"),h=(0,l.up)("q-dialog"),C=(0,l.up)("CuponDialog"),y=(0,l.Q2)("close-popup");return(0,l.wg)(),(0,l.iD)("div",null,[(0,l.Wm)(d,{disable:e.disable,class:"q-ma-sm full-width",color:"primary",icon:"history_edu",label:"FACTURAR",onClick:a[0]||(a[0]=a=>e.dialog=!0)},null,8,["disable"]),(0,l.Wm)(h,{modelValue:e.dialog,"onUpdate:modelValue":a[7]||(a[7]=a=>e.dialog=a),persistent:"",maximized:e.maximizedToggle,"transition-show":"slide-up","transition-hide":"slide-down"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{class:"bg-white text-black",style:{width:"650px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(s,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,i.zw)(e.Credito)+" - "+(0,i.zw)(e.tipoPedido)+" -"+(0,i.zw)(e.contingencia)+" ",1),(0,l.Wm)(c),(0,l.Wm)(d,{dense:"",flat:"",icon:"minimize",onClick:a[1]||(a[1]=a=>e.maximizedToggle=!1),disable:!e.maximizedToggle},{default:(0,l.w5)((()=>[e.maximizedToggle?((0,l.wg)(),(0,l.j4)(u,{key:0,class:"bg-white text-primary"},{default:(0,l.w5)((()=>[T])),_:1})):(0,l.kq)("",!0)])),_:1},8,["disable"]),(0,l.Wm)(d,{dense:"",flat:"",icon:"crop_square",onClick:a[2]||(a[2]=a=>e.maximizedToggle=!0),disable:e.maximizedToggle},{default:(0,l.w5)((()=>[e.maximizedToggle?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(u,{key:0,class:"bg-white text-primary"},{default:(0,l.w5)((()=>[q])),_:1}))])),_:1},8,["disable"]),(0,l.wy)(((0,l.wg)(),(0,l.j4)(d,{dense:"",flat:"",icon:"close"},{default:(0,l.w5)((()=>[(0,l.Wm)(u,{class:"bg-white text-primary"},{default:(0,l.w5)((()=>[k])),_:1})])),_:1})),[[y]])])),_:1}),(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l._)("div",F,"Pedido "+(0,i.zw)(e.numeroPedido),1),(0,l._)("div",I,"Serie "+(0,i.zw)(e.serie),1),(0,l._)("div",A,"Total Q."+(0,i.zw)(e.subtotal.toFixed(2)),1),(0,l.Wm)(f,{onSubmit:e.onSubmit},{default:(0,l.w5)((()=>[(0,l._)("div",R,[(0,l._)("div",E,[(0,l.Wm)(v,{filled:"",modelValue:e.efectivo,"onUpdate:modelValue":a[3]||(a[3]=a=>e.efectivo=a),type:"text",label:"Efectivo",class:"q-ma-sm",prefix:"Q.",onKeydown:(0,x.D2)(e.onSubmit,["enter"])},{before:(0,l.w5)((()=>[(0,l.Wm)(m,{name:"account_balance_wallet",color:"brown"})])),_:1},8,["modelValue","onKeydown"]),(0,l.Wm)(v,{filled:"",modelValue:e.tarjetaCredito,"onUpdate:modelValue":a[4]||(a[4]=a=>e.tarjetaCredito=a),type:"text",label:"Tarjeta de Credito",class:"q-ma-sm",prefix:"Q.",onKeydown:(0,x.D2)(e.onSubmit,["enter"])},{before:(0,l.w5)((()=>[(0,l.Wm)(m,{name:"credit_card",color:"blue"})])),_:1},8,["modelValue","onKeydown"])]),(0,l._)("div",Z,[(0,l.Wm)(p,{modelValue:e.conTarjeta,"onUpdate:modelValue":a[5]||(a[5]=a=>e.conTarjeta=a),label:"COBRO CON TARJETA"},null,8,["modelValue"])])]),(0,l._)("div",W,[(0,l._)("div",S,[(0,l._)("div",z," Cambio Q."+(0,i.zw)(((e.efectivo?e.efectivo:e.tarjetaCredito)-e.subtotal).toFixed(2)),1)]),(0,l._)("div",N,[(0,l.Wm)(d,{label:"Cupon",color:"primary",class:"q-ma-sm",icon:"local_activity",onClick:e.usarCupon},null,8,["onClick"])]),(0,l._)("div",Q,[(0,l.Wm)(d,{label:"Cobrar",color:"blue",icon:"point_of_sale",onClick:a[6]||(a[6]=a=>e.onSubmit()),disable:e.loadFacturando,loading:e.loadFacturando},{loading:(0,l.w5)((()=>[(0,l.Wm)(g,{class:"on-left"}),U])),_:1},8,["disable","loading"])])])])),_:1},8,["onSubmit"])])),_:1})])),_:1})])),_:1},8,["modelValue","maximized"]),(0,l.Wm)(C,{ref:"cuponRef",numeroPedido:e.numeroPedido,onOk:e.onOkCupon},null,8,["numeroPedido","onOk"])])}var D=o(97579),O=o(17779),V=function(e,a,o,l){function i(e){return e instanceof o?e:new o((function(a){a(e)}))}return new(o||(o=Promise))((function(o,t){function n(e){try{d(l.next(e))}catch(a){t(a)}}function r(e){try{d(l["throw"](e))}catch(a){t(a)}}function d(e){e.done?o(e.value):i(e.value).then(n,r)}d((l=l.apply(e,a||[])).next())}))};const j=(0,l.aZ)({name:"FacturacionMayDialog",components:{CuponDialog:D.Z},emits:["facturado","cuponAplicado"],props:{numeroPedido:{type:Number,required:!0},serie:{type:String,required:!0},contingencia:{type:Boolean,default:!1},Total:{type:Number,required:!0,default:0},disable:{type:Boolean,default:!1},Credito:{type:String,required:!0},tipoPedido:{type:Number,required:!0}},setup(e,{emit:a}){const o=(0,_.iH)(!1),i=(0,_.iH)(!1),t=(0,_.iH)(e.serie),n=(0,_.iH)(),r=(0,_.iH)(),d=(0,_.iH)(0),c=(0,_.iH)(""),u=(0,_.iH)(!1),s=(0,_.iH)(""),m=(0,_.iH)(!1),v=(0,_.iH)(e.Total),p=(0,_.iH)(!1),g=(0,_.iH)(null);(0,l.YP)(e,(()=>{t.value=e.serie,v.value=e.Total}));const f=()=>V(this,void 0,void 0,(function*(){yield w.api.get(w.endPoints.DATOSVEND+"DATAIMP",(0,w.configApi)({serie:t.value,queryParams:{tipo:e.Credito}})).then((e=>{s.value=e.data.Impresion})).catch((e=>{throw(0,y.L1)(e),e}))})),b=()=>V(this,void 0,void 0,(function*(){let l=!1;u.value=!0,yield f(),yield w.api.post(w.endPoints.FACTURAR,e.numeroPedido,(0,w.configApi)({serie:t.value,queryParams:{contingencia:e.contingencia,recargo:p.value}})).then((e=>{d.value=e.data.Factura,c.value=e.data.Uuid,(0,y.dF)("Factura "+d.value.toString()+" generada correctamente con UUID "+c.value,{position:"top"}),l=!0})).catch((e=>{(0,y.L1)(e,{timeout:0})})),u.value=!1,l&&e.contingencia?h():l&&"TKT"===s.value?T():l&&"DOC"===s.value&&x(),a("facturado",!0),o.value=!1,m.value=!1})),h=()=>{let e=10,a=10;screen.width,screen.height;let o="#/Reportes/CONTINGENCIA/"+t.value+"/"+d.value.toString();O.log(o);try{var l=window.open(o,"Factura","addressbar=no,directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=no,width="+e+", height="+a+", top=0, left=0");const i=setInterval((()=>{(null===l||void 0===l?void 0:l.closed)&&(clearInterval(i),t.value="",d.value=0)}),500)}catch(i){O.log(i)}},P=()=>{p.value=!1,m.value?w.api.get(w.endPoints.RECARGO+2).then((e=>{let a=e.data.Recargo;"I"!==a.Estado?(p.value=!0,v.value=v.value+v.value*(a.Porcentaje/100)):(0,y.dF)("Ahora no se está cobrando recargo",{tipo:"warning"})})).catch((e=>{(0,y.L1)(e)})):v.value=e.Total},x=()=>{if((0,C.Qe)()){window.open(C.qC+c.value);return a("facturado",!0),void(o.value=!1)}let e={printer:(0,C.LX)(),url:C.qC+c.value,filename:"factura.pdf"};w.api.post(C.Rz,e).then((e=>{O.log(e.data),(0,y.dF)(e.data),a("facturado",!0),o.value=!1})).catch((e=>{(0,y.L1)(e),a("facturado",!0),o.value=!1}))},T=()=>{let e=10,l=10;screen.width,screen.height;let i="#/Reportes/FACTURA/"+t.value+"/"+d.value.toString();O.log(i);try{var n=window.open(i,"Factura","addressbar=no,directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=no,width="+e+", height="+l+", top=0, left=0");const t=setInterval((()=>{(null===n||void 0===n?void 0:n.closed)&&(clearInterval(t),a("facturado",!0),o.value=!1)}),500)}catch(r){O.log(r)}},q=()=>{a("cuponAplicado",!0)},k=()=>{var e;null===(e=g.value)||void 0===e||e.show()};return{onSubmit:b,Imprimir:T,aplicarRecargo:P,onOkCupon:q,usarCupon:k,dialog:o,maximizedToggle:i,efectivo:n,tarjetaCredito:r,numeroFactura:d,loadFacturando:u,conTarjeta:m,subtotal:v,cuponRef:g}},watch:{conTarjeta(){this.efectivo=null,this.tarjetaCredito=null,this.aplicarRecargo()}},created(){},mounted(){}});var L=o(11639),M=o(68879),B=o(32074),G=o(44458),K=o(64526),Y=o(90136),J=o(46858),X=o(63190),$=o(8326),ee=o(13119),ae=o(22857),oe=o(11221),le=o(96335),ie=o(62146),te=o(69984),ne=o.n(te);const re=(0,L.Z)(j,[["render",H]]),de=re;ne()(j,"components",{QBtn:M.Z,QDialog:B.Z,QCard:G.Z,QBar:K.Z,QSpace:Y.Z,QTooltip:J.Z,QCardSection:X.Z,QForm:$.Z,QInput:ee.Z,QIcon:ae.Z,QCheckbox:oe.Z,QSpinnerHourglass:le.Z}),ne()(j,"directives",{ClosePopup:ie.Z});var ce=o(41355),ue=o(17779),se=function(e,a,o,l){function i(e){return e instanceof o?e:new o((function(a){a(e)}))}return new(o||(o=Promise))((function(o,t){function n(e){try{d(l.next(e))}catch(a){t(a)}}function r(e){try{d(l["throw"](e))}catch(a){t(a)}}function d(e){e.done?o(e.value):i(e.value).then(n,r)}d((l=l.apply(e,a||[])).next())}))};const me=[{name:"Pedido",label:"Pedido",field:"Pedido",align:"center"},{name:"Nit",label:"Nit",field:"Nit",align:"center"},{name:"Nombre",label:"Nombre",field:"Nombre",align:"center"},{name:"Total",label:"Total",field:"Total",align:"center"},{name:"Vendedor",label:"Vendedor",field:"Vendedor",align:"center"},{name:"Fecha",label:"Fecha Caja",field:"Fecha",align:"center"},{name:"Bodega",label:"Bodega",field:"Bodega",align:"center"},{name:"Ruta",label:"Ruta",field:"Ruta",align:"center"},{name:"Condicion",label:"Condición",field:"Condicion",align:"center"},{name:"Tipo",label:"Tipo",field:"Tipo",align:"center"},{name:"Estado",label:"Estado",field:"Estado",align:"center"}],ve=(0,l.aZ)({name:"FacturacionMayorista",setup(){var e,a,o,l,i;const t=(0,P.z)(),n=(0,_.iH)([]),r=(0,_.iH)(0),d=(0,_.iH)(""),c=(0,_.iH)(!1),u=(0,_.iH)(0),s=(0,_.iH)(""),m=(0,_.iH)(""),v=(0,_.iH)(0),p=(0,_.iH)(!1),g=(0,_.iH)(!1);1===(null===(e=ce.Z.ws)||void 0===e?void 0:e.OPEN)&&(g.value=!0),null===(a=ce.Z.ws)||void 0===a||a.addEventListener("open",(()=>{g.value=!0})),null===(o=ce.Z.ws)||void 0===o||o.addEventListener("message",(e=>{"nuevo-pedido-fact"===e.data&&(ue.log(e.data),f())})),null===(l=ce.Z.ws)||void 0===l||l.addEventListener("error",(()=>{ue.log("error dialgo"),g.value=!1})),null===(i=ce.Z.ws)||void 0===i||i.addEventListener("close",(()=>{g.value=!1}));const f=()=>se(this,void 0,void 0,(function*(){r.value=0,d.value="",m.value="",v.value=0,p.value=!0,yield w.api.get(w.endPoints.PEDIDOSMAYORISTA).then((e=>{n.value=e.data.Pedidos})).catch((e=>{})),p.value=!1})),b=(e,a)=>{r.value=a.Pedido,d.value=a.Condicion,m.value=a.Tipo,v.value=a.Total,k(m.value)},x=()=>se(this,void 0,void 0,(function*(){let e=r.value;yield f(),r.value=e;var a=n.value.find((e=>e.Pedido===r.value));b(null,a)})),T=()=>{f()},q=()=>{let e=10,a=10;var o=screen.width/2-(e+50),l=screen.height/2-(a+50);let i="#/Reportes/PEDIDOSU/"+r.value;ue.log(i);try{var t=window.open(i,"Factura","addressbar=no,directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=no,width="+e+", height="+a+", top="+l+", left="+o);const n=setInterval((()=>{(null===t||void 0===t?void 0:t.closed)&&(clearInterval(n),r.value=0)}),500)}catch(n){ue.log(n)}},k=(e="")=>{var a,o,l,i;""!==e?"FACT"===e?s.value=null!==(a=(0,C.dS)())&&void 0!==a?a:"":"FCRE"===e?s.value=null!==(o=(0,C.JT)())&&void 0!==o?o:"":"FCON"===e?s.value=null!==(l=(0,C.V6)())&&void 0!==l?l:"":"FRUT"===e&&(s.value=null!==(i=(0,C.nZ)())&&void 0!==i?i:""):s.value=""},F=()=>{let e=10,a=10;screen.width,screen.height;let o="#/Reportes/CONTINGENCIA/"+s.value+"/"+u.value.toString();ue.log(o);try{var l=window.open(o,"Factura","addressbar=no,directories=0,titlebar=0,toolbar=0,location=0,status=0,menubar=0,scrollbars=no,width="+e+", height="+a+", top=0, left=0");const i=setInterval((()=>{(null===l||void 0===l?void 0:l.closed)&&(clearInterval(i),s.value="",u.value=0)}),500)}catch(i){ue.log(i)}},I=()=>se(this,void 0,void 0,(function*(){if(s.value=yield(0,y.UA)("Serie","Ingrese la serie"),null!==s.value){let e=yield(0,y.UA)("Factura","Ingrese el número de factura");null!==e&&(u.value=e,F())}})),A=()=>se(this,void 0,void 0,(function*(){if(s.value=yield(0,y.UA)("Serie","Ingrese la serie"),null!==s.value){let e=yield(0,y.UA)("Factura","Ingrese el número de factura");null!==e&&(u.value=e,yield w.api.get(w.endPoints.FACTURAR,(0,w.configApi)({serie:s.value,queryParams:{numeroFactura:u.value}})).then((e=>{null!==e.data.Encabezado?(0,C.Qe)()?open(C.qC+e.data.Encabezado.Uuid,"factura"):(0,h.EW)((0,C.LX)(),"factura.pdf",{urlDownload:C.qC+e.data.Encabezado.Uuid}):(0,y.x2)("No existe la factura")})).catch((e=>{(0,y.L1)(e)})).finally((()=>{s.value="",u.value=0})))}})),R=()=>{w.api.post(w.endPoints.PEDIDOENC+"cambiarEstado",r.value).then((e=>{(0,y.dF)("Pedido regresado"),f()})).catch((e=>{(0,y.L1)(e)}))};return{getPedidos:f,selectProd:b,facturar:T,reimprimirContingencia:I,reimprimirFel:A,regresar:R,reimprmirPedido:q,updateTotal:x,facturacion:t,columnas:me,rows:n,numeroPedido:r,contingencia:c,serie:s,condicion:d,tipo:m,total:v,loading:p,wsStatus:g}},created(){this.getPedidos(),this.facturacion.serie=""},watch:{serie(e){var a;this.facturacion.serie=null!==(a=this.serie)&&void 0!==a?a:""}},components:{FacturacionMayDialog:de}});var pe=o(69885),ge=o(20990),fe=o(60854),be=o(31233),we=o(67220),he=o(84277);const Ce=(0,L.Z)(ve,[["render",b]]),ye=Ce;ne()(ve,"components",{QPage:pe.Z,QBtn:M.Z,QCheckbox:oe.Z,QBadge:ge.Z,QInnerLoading:fe.Z,QTr:be.Z,QTd:we.Z,QTable:he.Z})}}]);