"use strict";(globalThis["webpackChunkposweb"]=globalThis["webpackChunkposweb"]||[]).push([[5281],{5281:(e,a,o)=>{o.r(a),o.d(a,{default:()=>ne});var l=o(59835),n=o(86970);const t={class:"row"},r={key:0,class:"col-12"},i={class:"row justify-center q-ma-md"},s={class:"col-12 col-sm-6 col-md-6"},u={class:"q-ma-sm"},c={class:"row q-ma-md"},d={class:"absolute-full"},p={class:"full-width q-pa-none q-ma-none flex flex-center",style:{height:"50%"}},m={class:"full-width q-pa-none q-ma-none flex flex-center",style:{height:"50%"}};function g(e,a,g,v,f,w){const h=(0,l.up)("install-banner"),b=(0,l.up)("q-btn"),y=(0,l.up)("q-space"),S=(0,l.up)("q-spinner-facebook"),k=(0,l.up)("q-slide-transition"),q=(0,l.up)("q-img"),Z=(0,l.up)("q-card-section"),_=(0,l.up)("q-icon"),x=(0,l.up)("q-input"),P=(0,l.up)("q-form"),R=(0,l.up)("q-card"),W=(0,l.up)("q-pull-to-refresh"),C=(0,l.up)("q-badge"),E=(0,l.up)("q-linear-progress"),O=(0,l.up)("q-inner-loading"),Q=(0,l.up)("q-page"),L=(0,l.up)("q-page-container"),N=(0,l.up)("q-layout");return(0,l.wg)(),(0,l.j4)(N,null,{default:(0,l.w5)((()=>[(0,l.Wm)(L,null,{default:(0,l.w5)((()=>[(0,l.Wm)(Q,null,{default:(0,l.w5)((()=>[(0,l.Wm)(h),(0,l.Wm)(b,{label:"admin",onClick:a[0]||(a[0]=a=>{e.$router.push("/LOGIN")})}),(0,l.Wm)(b,{label:"sistema",onClick:a[1]||(a[1]=a=>{e.$router.push("/LOGINERP")})}),(0,l._)("div",t,[(0,l.Wm)(y),e.$q.platform.is.mobile?((0,l.wg)(),(0,l.iD)("div",r)):(0,l.kq)("",!0),(0,l.Wm)(b,{color:"primary",icon:"change_circle",label:"Cambiar Empresa",onClick:e.changeSetting,outline:""},null,8,["onClick"]),(0,l.Wm)(b,{color:"red",icon:"clear_all",label:"Limpiar sesión",onClick:e.clearAll,outline:""},null,8,["onClick"])]),(0,l.Wm)(W,{onRefresh:e.refresh},{default:(0,l.w5)((()=>[(0,l._)("div",i,[(0,l._)("div",s,[(0,l.Wm)(k,null,{default:(0,l.w5)((()=>[e.loading?((0,l.wg)(),(0,l.j4)(S,{key:0,color:"blue",size:"100%"})):(0,l.kq)("",!0)])),_:1}),e.loading?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(R,{key:0,class:""},{default:(0,l.w5)((()=>[(0,l.Wm)(Z,null,{default:(0,l.w5)((()=>[e.getLogo()?((0,l.wg)(),(0,l.j4)(q,{key:0,src:o(76209)("./"+e.getLogo()),style:{"max-width":"100%",height:"150px"},fit:"contain","spinner-color":"primary","spinner-size":"82px"},null,8,["src"])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(Z,{class:"center",id:"login-sucursal"},{default:(0,l.w5)((()=>[(0,l._)("h4",u,(0,n.zw)(e.nombreSucursal)+" - "+(0,n.zw)(e.bodega)+"-"+(0,n.zw)(e.nombreBodega),1)])),_:1}),(0,l.Wm)(Z,null,{default:(0,l.w5)((()=>[(0,l.Wm)(P,{onSubmit:e.onSubmit},{default:(0,l.w5)((()=>[(0,l.Wm)(x,{for:"login-pass",autofocus:"",ref:"RefPass",label:"Contraseña",modelValue:e.password,"onUpdate:modelValue":a[2]||(a[2]=a=>e.password=a),type:e.showPassword?"text":"password",rules:[e=>e&&e.length>0||"Ingrese una contraseña"]},{prepend:(0,l.w5)((()=>[(0,l.Wm)(_,{name:"lock",color:"black"})])),append:(0,l.w5)((()=>[(0,l.Wm)(_,{name:e.showPassword?"visibility":"visibility_off",onClick:e.changeShow,color:"black"},null,8,["name","onClick"])])),_:1},8,["modelValue","type","rules"]),(0,l._)("div",c,[(0,l.Wm)(b,{id:"login-submit",color:"primary",label:"Ingresar",class:"col-12",type:"submit"})])])),_:1},8,["onSubmit"])])),_:1})])),_:1}))])])])),_:1},8,["onRefresh"]),(0,l.Wm)(O,{showing:e.downloading},{default:(0,l.w5)((()=>[(0,l.Wm)(E,{stripe:"",size:"60px",value:e.progress+5,color:"primary"},{default:(0,l.w5)((()=>[(0,l._)("div",d,[(0,l._)("div",p,[(0,l.Wm)(C,{color:"white","text-color":"accent",label:(100*e.progress).toFixed(2).toString()+"%"},null,8,["label"])]),(0,l._)("div",m,[(0,l.Wm)(C,{color:"white","text-color":"accent",label:e.downloaded.toString()+"/"+e.downloadSize.toString()+" MB"},null,8,["label"])])])])),_:1},8,["value"]),(0,l.Wm)(b,{class:"q-mt-lg",color:"red",icon:"cancel",label:"Cancelar",onClick:e.cancelDownload},null,8,["onClick"])])),_:1},8,["showing"])])),_:1})])),_:1})])),_:1})}var v=o(60499),f=o(18910),w=o(34136),h=o(68651),b=o(67825),y=o(37655),S=o(51745),k=o(61563),q=o(3833),Z=o(57674),_=o(41355),x=o(47506),P=o(4147),R=o(17779),W=function(e,a,o,l){function n(e){return e instanceof o?e:new o((function(a){a(e)}))}return new(o||(o=Promise))((function(o,t){function r(e){try{s(l.next(e))}catch(a){t(a)}}function i(e){try{s(l["throw"](e))}catch(a){t(a)}}function s(e){e.done?o(e.value):n(e.value).then(r,i)}s((l=l.apply(e,a||[])).next())}))};const C=()=>W(void 0,void 0,void 0,(function*(){let e=null;const a={method:"GET",redirect:"follow"},o=Promise.race([fetch(w.urlFront.value+"/info.json",a).then((e=>e.text())),new Promise(((e,a)=>setTimeout((()=>a(new Error("Timeout al verificar versión"))),25e3)))]);return yield o.then((a=>{const o=JSON.parse(a);e=o.version})).catch((a=>{e=null,(0,h.L1)(a)})),e})),E=()=>W(void 0,void 0,void 0,(function*(){let e=!1;if(x.ZP.is.nativeMobile){const a=yield C();R.log("new",a);const o=P.version;R.log("ant",o),null!==a&&void 0!==a&&a.trim()!==o.trim()&&(e=!0,(0,h.dF)("Nueva actualización "+a+". Actual "+o))}return e}));var O=o(74801),Q=o(78618),L=o(17779),N=function(e,a,o,l){function n(e){return e instanceof o?e:new o((function(a){a(e)}))}return new(o||(o=Promise))((function(o,t){function r(e){try{s(l.next(e))}catch(a){t(a)}}function i(e){try{s(l["throw"](e))}catch(a){t(a)}}function s(e){e.done?o(e.value):n(e.value).then(r,i)}s((l=l.apply(e,a||[])).next())}))};const H=(0,l.aZ)({setup(){(0,b.RY)(),(0,b.gy)();const e=(0,f.tv)(),a=(0,v.iH)(e.currentRoute.value.params.id.toString()),o=(0,v.iH)(e.currentRoute.value.params.EMPRESA.toString()),l=(0,v.iH)(e.currentRoute.value.params.Serie.toString()),n=(0,v.iH)(""),t=(0,v.iH)(""),r=(0,v.iH)(!1),i=(0,v.iH)(""),s=(0,v.iH)(!1),u=(0,v.iH)(!1),c=(0,v.iH)(!1),d=(0,v.iH)(0),p=(0,v.iH)(0),m=(0,v.iH)(0),g=(0,v.iH)(null),k=()=>{!0===s.value?s.value=!1:s.value=!0},Z=()=>N(this,void 0,void 0,(function*(){u.value=!0,yield w.api.get(w.endPoints.SUCURSAL+a.value).then((a=>{null===a.data.Nombre&&e.replace("/Error"),n.value=a.data.Nombre,t.value=a.data.Bodega.Nombre,P(a.data.Sucursal),u.value=!1})).catch((e=>{L.log(e),(0,h.L1)(e)})),x()})),x=()=>{const e=[];e.push({id:"login-sucursal",texto:"Nombre de la sucursal actual",titulo:"Sucursal",scroll:!0}),e.push({id:"login-pass",texto:"Campo para ingresar su contraseña"}),e.push({id:"login-submit",texto:"Botón para ingresar al sistema o con la tecla enter en el campo de contraseña de ingresar su contraseña"});const a=(0,S.Z)(e,"login");null===a||void 0===a||a.start(),(0,b.KY)("login")},P=e=>{(0,b.lT)(e)},R=e=>{a.value=e,(0,b.$p)(a.value)},W=e=>{o.value=e,(0,b._q)(o.value)},C=e=>{l.value=e,L.log("set")},H=()=>{null!==(0,b.Xw)("validar ruta")&&e.replace("/POS/POS")},D=()=>N(this,void 0,void 0,(function*(){r.value=!0,(0,y.Q)(),yield w.api.post(w.endPoints.LOGIN,i.value).then((a=>{null!==a.data?((0,b.G8)(a.data.Vendedor.CODIGO_VENDEDOR),(0,b.o4)(a.data.Token),(0,b.UG)(a.data.Vendedor.NOMBRE_VENDEDOR),(0,h.dF)("Bienvenid@ "+a.data.Vendedor.NOMBRE_VENDEDOR),_.Z.crear(),e.replace("/INIT/POS")):(0,h.x2)("Contraseña incorrecta")})).catch((e=>{var a,o;(0,h.L1)(e),null===(a=g.value)||void 0===a||a.focus(),null===(o=g.value)||void 0===o||o.select()})).finally((()=>{r.value=!0,(0,y.E)()}))})),F=()=>{L.log("reload"),location.reload()},I=()=>{q.Z.remove("EMPRESA"),e.replace("/")},B=()=>{(0,h.wp)("Limpiar","¿Está segur@ de borrar la configuración?",{onPressOk:()=>{(0,b.Ov)(!0)},onPressCancel:()=>{}})},T=()=>N(this,void 0,void 0,(function*(){const e=yield E();e&&(c.value=!0,O.Z.stop(),yield(0,Q._R)(1e3),yield O.Z.download(w.api.defaults.baseURL+"/Public/posweb.apk",{onDownloadProgress:function(e){const a=(e.progress/100).toFixed(2);d.value=parseFloat(a),p.value=parseFloat((e.bytes/1e6).toFixed(2)),m.value=parseFloat((e.bytesWritten/1e6).toFixed(2))}},(function(){(0,h.dF)("Descargado"),c.value=!1,O.Z.install()}),(function(e){L.log("ERROR DOWN ",e.message+"\n"+e.stack),c.value=!1,(0,h.x2)(e.message)})))})),z=()=>{c.value=!1,O.Z.stop()};return{bodega:a,empresa:o,password:i,showPassword:s,loading:u,loadLogin:r,nombreSucursal:n,nombreBodega:t,downloading:c,progress:d,downloadSize:p,downloaded:m,RefPass:g,changeShow:k,consultarSucursal:Z,cambiarbodega:R,cambiarEmpresa:W,cambiarSerie:C,onSubmit:D,validarRuta:H,getLogo:b.R7,reload:F,changeSetting:I,clearAll:B,updater:T,cancelDownload:z,refresh(e){location.reload()}}},created(){var e;null===(e=_.Z.ws)||void 0===e||e.close(),_.Z.ws=null,this.consultarSucursal(),(0,Z.Z)("primary","#1976d2"),this.updater()},mounted(){},beforeRouteUpdate(e){this.consultarSucursal()},beforeMount(){this.$nextTick((()=>{}))},methods:{},components:{InstallBanner:k.Z}});var D=o(11639),F=o(20249),I=o(12133),B=o(69885),T=o(68879),z=o(90136),V=o(90699),G=o(69003),M=o(27234),j=o(44458),A=o(63190),U=o(91487),$=o(8326),Y=o(13119),J=o(22857),K=o(60854),X=o(8289),ee=o(20990),ae=o(69984),oe=o.n(ae);const le=(0,D.Z)(H,[["render",g]]),ne=le;oe()(H,"components",{QLayout:F.Z,QPageContainer:I.Z,QPage:B.Z,QBtn:T.Z,QSpace:z.Z,QPullToRefresh:V.Z,QSlideTransition:G.Z,QSpinnerFacebook:M.Z,QCard:j.Z,QCardSection:A.Z,QImg:U.Z,QForm:$.Z,QInput:Y.Z,QIcon:J.Z,QInnerLoading:K.Z,QLinearProgress:X.Z,QBadge:ee.Z})}}]);